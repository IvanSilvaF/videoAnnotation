<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Customise HTML5 video player</title>
  <link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet" />
  <link href="https://unpkg.com/@videojs/themes@1/dist/city/index.css" rel="stylesheet">
  <link href="css/chapter.css" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
    <div class="left">
        <p>  
          <input placeholder="Search" type="text" id="searchText" onkeyup="searchAnnotation()"/>
          <ul id="listComments"></ul> 
        </p>
    </div>
    <div class="main">
        <div id="divVideo">
          <video id="ml" class="video-js vjs-custom-theme" data-setup="{}" preload="auto" controls autoplay="true" width="950" height="534">
              <source src="machine learning.mp4" type="video/mp4" />      
          </video>
        </div>
        <br />
        <input type="text" id="myText" />
        <button onclick = "addAnnotation()" > Add addAnnotation </button>
        <br />
        <br />
        <button onclick = "prevChapter()" > Previos </button>
        <button onclick = "nextChapter()" > Next </button>        
    </div>

<script src="https://vjs.zencdn.net/7.21.1/video.min.js"></script>
<script src="js/chapter.js"></script>
<script>

  function drawAnnotation(){
    //deleteDraw()
    var myPlayer = videojs('ml');
    const timeAUX = myPlayer.currentTime();
    ///time=secondsToTime(timeAUX);
    //alert(timeAUX)
    //alert(time)
    for(var i=0;i<videoAnnotation.length;i++)
    {
      //alert("for")
      if(timeAUX>videoAnnotation[i].time_start && timeAUX<videoAnnotation[i].time_end){
        //alert("if")
        var divVideo= document.getElementById('divVideo');
        var divAnnnotation = document.createElement("div");
        divAnnnotation.style.position='absolute';
        divAnnnotation.style.height=videoAnnotation[i].height;
        divAnnnotation.style.width= videoAnnotation[i].width;
        divAnnnotation.style.borderRadius= '100%';
        divAnnnotation.style.top= videoAnnotation[i].top;
        divAnnnotation.style.left= videoAnnotation[i].left;
        divAnnnotation.style.zIndex= '1';
        divAnnnotation.style.border= '3px solid green';
        //divAnnnotation.classList.add("anotattionList")
        divVideo.append(divAnnnotation)
      }
    }
    //alert("draw")
    //function always runing
    
  }
  function deleteDraw(){
    listDiv = document.getElementsByClassName("anotattionList");
    for (i = 0; i < listDiv.length; i++){
      listDiv[i].remove();
    }
  }
    function searchAnnotation(){
      list = document.getElementById("listComments");
      var searchText = document.getElementById("searchText").value;
      b = list.getElementsByTagName("LI");
      if (searchText==""){
        for (i = 0; i < b.length; i++) {b[i].style.display = 'block';}
      }
      else{
        for (i = 0; i < b.length; i++) {
          spans=b[i].getElementsByTagName("span")
          if (spans[1].innerText.toLowerCase().includes(searchText.toLowerCase())) {
            b[i].style.display = 'block';
            }
          else{
            b[i].style.display = 'none';}
        }
      }}
    function secondsToTime(e){
        const h = Math.floor(e / 3600).toString().padStart(2,'0'),
            m = Math.floor(e % 3600 / 60).toString().padStart(2,'0'),
            s = Math.floor(e % 60).toString().padStart(2,'0');        
        return h + ':' + m + ':' + s;}
    function addAnnotation() {
        var myPlayer = videojs('ml');
        var annotation = document.getElementById("myText").value;
        if (myPlayer.readyState() < 1) {
            // wait for loadedmetdata event
            myPlayer.one("loadedmetadata", onLoadedMetadata);
        }else if(annotation!=""){
            const timeAUX = myPlayer.currentTime();
            time=secondsToTime(timeAUX);
            var ul = document.getElementById("listComments");
            var li = document.createElement("li");
            var p=document.createElement("span");
            p.innerText=time
            li.appendChild(p);
            li.appendChild(document.createElement("br"));
            var ptext=document.createElement("span");
            ptext.innerText=annotation
            li.appendChild(ptext);
            li.appendChild(document.createElement("br"));
            var pdelete=document.createElement("span");
            pdelete.setAttribute('onclick',"deleteComment(this.parentNode.id)");
            pdelete.innerText="Delete"
            pdelete.style.color = "red";
            li.appendChild(pdelete);
            li.setAttribute("id", myPlayer.currentTime()); // added line
            ul.appendChild(li);
            document.getElementById("myText").value=""
            orderComments();
        }
     }
    function deleteComment(id){
      document.getElementById(id).remove()}
    function nextChapter(){
      var myPlayer = videojs('ml');
      var currenteTime=myPlayer.currentTime()

      for(var i=0;i<markers.length;i++)
      {
        if (markers[i].time>=parseInt(currenteTime)+2){
          myPlayer.currentTime(markers[i].time);
          break;
        }
      }}  
      //myPlayer.currentTime(150)}
    function prevChapter(){
      var myPlayer = videojs('ml');
      var currenteTime=myPlayer.currentTime()
      
      for(var i=markers.length;i>0;i--)
      {
        if (parseInt(currenteTime)>markers[i-1].time){
          myPlayer.currentTime(markers[i-1].time);
          break;
        }
      }}

    function orderComments(){
      var list, i, switching, b, shouldSwitch;
      list = document.getElementById("listComments");
      switching = true;
      /* Make a loop that will continue until
      no switching has been done: */
      while (switching) {
        // start by saying: no switching is done:
        switching = false;
        b = list.getElementsByTagName("LI");
        // Loop through all list-items:
        for (i = 0; i < (b.length - 1); i++) {
          // start by saying there should be no switching:
          shouldSwitch = false;
          /* check if the next item should
          switch place with the current item: */
          if (b[i].innerHTML.toLowerCase() > b[i + 1].innerHTML.toLowerCase()) {
            /* if next item is alphabetically
            lower than current item, mark as a switch
            and break the loop: */
            shouldSwitch = true;
            break;
          }
        }
        if (shouldSwitch) {
          /* If a switch has been marked, make the switch
          and mark the switch as done: */
          b[i].parentNode.insertBefore(b[i + 1], b[i]);
          switching = true;
        }      
      }}
</script>
  
</body>
</html>